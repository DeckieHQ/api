machine:
  pre:
    - sudo pip install -U docker-compose==1.5.2
    - sudo wget -O- https://toolbelt.heroku.com/install-ubuntu.sh | sh
  services:
    - docker

dependencies:
  override:
    - bash scripts/heroku.sh provision_ci ci-$CIRCLE_BUILD_NUM

database:
  override:
    - make migrations

test:
  pre:
    - bash scripts/heroku.sh env ci-$CIRCLE_BUILD_NUM
  override:
    - make test
  post:
    - bash scripts/heroku.sh clean ci-$CIRCLE_BUILD_NUM

deployment:
  staging:
    branch: master
    commands:
      - bash scripts/heroku.sh deploy staging
